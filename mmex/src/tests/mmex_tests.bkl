<?xml version="1.0" ?>

<makefile>

    <!-- Default root of sources is dir where output script will be created.
         autoconf generates Makefile in trunk/mmex/src/tests but others in trunk/mmex/build/msw/tests.
    -->

    <if cond="FORMAT=='autoconf'">
        <set-srcdir>../..</set-srcdir>
    </if>

    <if cond="FORMAT!='autoconf'">
        <set-srcdir>../../..</set-srcdir>
    </if>
    
    
    <include file="../../build/bakefiles/common.bkl"/>
    <include file="../../build/bakefiles/sqlite.bkl"/>
    <include file="../../build/bakefiles/UnitTest++.bkl"/>
    

    <!-- unit tests console application -->

    <exe id="mmex_tests" template="mmex_common">

        <app-type>console</app-type>
        
        <library>sqlite3</library>
        <library>UnitTest++</library>

	<include>$(SRCDIR)/src</include>
	<include>$(SRCDIR)/UnitTest++/src</include>

    	<!-- relative to trunk/mmex -->

        <headers>$(fileList('src/tests/*.h'))</headers>
        <sources>$(fileList('src/tests/*.cpp'))</sources>

    </exe>

    
    <!-- make check -->

    <action id="check">

	<depends>mmex_tests</depends>
	<is-phony>on</is-phony>

	<set var="COPY_CMD">
	    <if cond="TOOLSET=='win32'">copy /Y</if>
	    <if cond="TOOLSET=='unix'">cp</if>
	</set>

	<set var="SRC_PATH">$(SRCDIR)/runtime/currency.db3</set>

	<command>
	    $(COPY_CMD) $(nativePaths(SRC_PATH)) $(nativePaths(BUILDDIR))
	    $(BUILDDIR)/mmex_tests
	</command>

	<clean-files>currency.db3</clean-files>
	
    </action>


</makefile>
