<?xml version="1.0" ?>

<makefile>

    <!-- Default root of sources is dir where output script will be created.
         autoconf generates Makefile in trunk/mmex/src/tests but others in trunk/mmex/build/msw/tests.
    -->

    <if cond="FORMAT=='autoconf'">
        <set-srcdir>../..</set-srcdir>
    </if>

    <if cond="FORMAT!='autoconf'">
        <set-srcdir>../../..</set-srcdir>
    </if>
    
    
    <include file="../../build/bakefiles/common.bkl"/>
    <include file="../../build/bakefiles/sqlite.bkl"/>
    <include file="../../build/bakefiles/UnitTest++.bkl"/>
    

    <!-- unit tests console application -->

    <exe id="mmex_tests" template="mmex_common">

        <app-type>console</app-type>
        
        <library>sqlite3</library>
        <library>UnitTest++</library>

	<include>$(SRCDIR)/src</include>
	<include>$(SRCDIR)/UnitTest++/src</include>

    	<!-- relative to trunk/mmex -->

    	<set var="SRC">src/tests</set>

        <headers>$(fileList(SRC + '/*.h'))</headers>
        <sources>$(fileList(SRC + '/*.cpp'))</sources>

        <win32-res>$(SRC)/mmex_tests.rc</win32-res>

    </exe>

    
    <!-- make check -->

    <action id="check">

        <depends>all</depends>
	<is-phony>on</is-phony>

	<command>
            <!-- && is "&amp;&amp;" in HTML -->
            cd $(nativePaths(SRCDIR + '/runtime')) &amp;&amp; $(nativePaths('../build/msw/tests/' + BUILDDIR + '/mmex_tests'))
	</command>

    </action>


</makefile>
