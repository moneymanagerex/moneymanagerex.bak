<?xml version="1.0" ?>

<makefile>

    <!-- Default root of sources is dir where output script will be created.
         autoconf script resides in trunk/mmex/src/tests but others in trunk/mmex/build/msw/tests.
    -->

    <if cond="FORMAT=='autoconf'">
        <set-srcdir>../..</set-srcdir>
    </if>

    <if cond="FORMAT!='autoconf'">
            <set-srcdir>../../..</set-srcdir>
    </if>

    
    <include file="../../build/bakefiles/presets/wx.bkl"/>
    <include file="../../build/bakefiles/sqlite.bkl"/>
    <include file="../../build/bakefiles/UnitTest++.bkl"/>
    

    <exe id="mmex_tests" template="wx">

        <app-type>console</app-type>
        <library>sqlite3</library>
        <library>UnitTest++</library>
        <debug-info>on</debug-info>
        <debug-info-edit-and-continue>on</debug-info-edit-and-continue>
        <warnings>max</warnings>
        <runtime-libs>dynamic</runtime-libs>
        <precomp-headers>off</precomp-headers>
        <threading>multi</threading>
        <cxx-exceptions>on</cxx-exceptions>
        <cxx-rtti>on</cxx-rtti>

	<include>$(SRCDIR)/src</include>
        <include>$(SRCDIR)/include</include>
	<include>$(SRCDIR)/sqlite</include>
	<include>$(SRCDIR)/UnitTest++/src</include>

	<win32-res>resources/mmex.rc</win32-res>

        <cxxflags>-DSQLITE_HAS_CODEC -DWXSQLITE3_HAVE_CODEC -DWXSQLITE3_HAVE_METADATA</cxxflags>

        <headers>$(fileList( [ 'src/*.h',   'src/tests/*.h'  ] ))</headers>
        <sources>$(fileList( [ 'src/*.cpp', 'src/tests/*.cpp'] ))</sources>


        <!-- wxWidgets libs -->

        <wx-lib>core</wx-lib>
        <wx-lib>net</wx-lib>                
        <wx-lib>html</wx-lib>                
        <wx-lib>xml</wx-lib>
        <wx-lib>aui</wx-lib> 
        <wx-lib>base</wx-lib>
        <wx-lib>adv</wx-lib>
        
    </exe>

    
    <action id="test">

	<depends>mmex_tests</depends>
	<is-phony>on</is-phony>

	<set var="COPY_CMD">
	    <if cond="TOOLSET=='win32'">copy /Y</if>
	    <if cond="TOOLSET=='unix'">cp</if>
	</set>

	<set var="SRC_PATH">$(SRCDIR)/runtime/currency.db3</set>

	<command>
	    $(COPY_CMD) $(nativePaths(SRC_PATH)) $(nativePaths(BUILDDIR))
	    $(BUILDDIR)/mmex_tests
	</command>

	<clean-files>currency.db3</clean-files>
	
    </action>

</makefile>
