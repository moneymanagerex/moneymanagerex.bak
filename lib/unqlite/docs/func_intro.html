<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en"><head>









  
  <meta content="text/html; charset=UTF-8" http-equiv="content-type"><title>UnQLite - Foreign Function Implementation Guide</title><!-- Copyright (C) 2013 Mrad Chems Eddine, Symisc Systems,http://www.symisc.net contact@symisc.net -->
  

  

  
  <link rel="stylesheet" href="symisc.css" type="text/css">

  
  <meta content="Symisc Systems &lt;chm@symisc.net&gt; - Mrad Chems Eddine" name="author">

  
  <meta content="http://unqlite.org/" name="description"></head><body>
<div style="width: 1092px;" id="main_div"><a href="http://unqlite.org/"><img style="border: 0px solid ; width: 170px; height: 70px;" alt="Symisc UnQLite" title="Symisc UnQLite" src="images/symisc-unqlite.png"></a><br>
<div style="text-align: left; width: 1080px;" align="right">
<table style="text-align: left; width: 1075px; height: 41px;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; width: 709px; height: 45px;"><small style="color: black; font-family: Verdana;"><small><br>
An Embeddable NoSQL Database Engine<br>
      </small></small></td>
      <td style="vertical-align: top; width: 162px; height: 45px;"><br>
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="unqlite_db" data-size="large">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></td>
      <td style="vertical-align: top; width: 176px; height: 45px;"><br>
      <a href="https://twitter.com/unqlite_db" class="twitter-follow-button" data-show-count="false" data-size="large">Follow
@unqlite_db</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></td>
    </tr>
  </tbody>
</table>
</div>
<hr style="width: 100%; height: 2px;">
<ul id="nav">
  <li id="nav-1"><a href="index.html">About</a></li>
  <li id="nav-8"><a href="features.html">Distinctive Features<br>
    </a></li>
  <li id="nav-2"><a href="intro.html">Getting Started<br>
    </a></li>
  <li id="nav-3"><a href="c_api.html">Documentation<br>
    </a></li>
  <li id="nav-4"><a href="downloads.html">Downloads<br>
    </a></li>
  <li id="nav-5"><a href="licensing.html">License<br>
    </a></li>
  <li id="nav-6"><a href="faq.html">FAQ<br>
    </a></li>
  <li id="nav-7"><a href="support.html">Online Support<br>
    </a></li>
</ul>
<h1><small><small><font face="Verdana, sans-serif"><b>UnQLite - Foreign Function
Implementation Guide.</b></font></small></small></h1>

<div>
<p style="font-weight: normal;" align="left"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">The
following quick guide is what you do to start experimenting with the
Jx9 (Via UnQLite) foreign function mechanism without having to do a lot
of tedious
reading.</font></font></p>

<p style="font-weight: normal;" align="left"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></p>

<p style="font-style: normal; font-weight: normal;" align="left"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font face="Verdana, sans-serif">Foreign
functions are used to add <a href="jx9.html">Jx9</a> functions or to redefine the behavior
of existing Jx9 functions from the outside environment (see below) to
the underlying <a href="c_api_object.html#unqlite_vm">virtual
machine</a>.
This mechanism is know as “In-process extending”. After successful call to <a style="font-family: Courier New;" href="c_api/unqlite_create_function.html">unqlite_create_function()</a>, the installed function is available immediately and can be
called from the target <a href="jx9.html">Jx9</a> code.</font></font></font></p>

<p style="font-style: normal; font-weight: normal;" align="left"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></p>

<p style="font-style: normal; font-weight: normal;" align="left"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">A
foreign function is simply a client function
typically implemented in C which is responsible of performing the desired
computation. There are many reasons to implement foreign functions,
one of them is to perform system calls and gain access to low level
resources which is impossible to do using standard Jx9 functions.</font></font></p>

<p style="font-style: normal; font-weight: normal;" align="left"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Another
reason to implement foreign functions is performance. That is, a
foreign function implemented in C will typically run 10 times faster
than its Jx9 counterpart, this is why most of the built-in
Jx9 functions (<a href="jx9_builtin.html">Over 312</a>
as of this release) such as <span style="font-family: Courier New;">db_store()</span>, <span style="font-family: Courier New;">db_create()</span>, <span style="font-family: Courier New;">json_encode()</span>, <span style="font-family: Courier New;">db_fetch()</span>, <span style="font-family: Courier New;">array_merge()</span>, <span style="font-family: Courier New;">chdir()</span>, <span style="font-family: Courier New;">fread()</span>, <span style="font-family: Courier New;">fopen()</span> and many more are
implemented in C rather than Jx9.</font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">The signature of the foreign function is as follows:</font></font></font></p>
<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></font></p>


<p style="margin-bottom: 0cm; font-family: Courier New;" align="center"><font color="#000000"><font style="font-size: 10pt;" size="2"><b><font color="#0000ff">int
</font><font color="#000000">(*xFunc)</font>(<span style="color: blue;">unqlite_context</span>
*pCtx,<font color="#0000ff">int
</font>argc,<span style="color: blue;">unqlite_value</span>
**argv)</b></font></font></p>

<p style="margin-bottom: 0cm;" align="center"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b><font face="Verdana, sans-serif"><br>
</font></b></font></font></font></p>


<p style="margin-bottom: 0cm;" align="left"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">The C function must </span></span></font></font></font><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">accept
three parameters. The first parameter is a pointer to a </span></span></font></font><a style="font-family: Courier New;" href="c_api_object.html#unqlite_context"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">unqlite_context</span></span></font></a><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">
structure. This is the context in which the foreign function
executes. In other words, this parameter is the intermediate between
the foreign function and the underlying </span></span></font></font><a href="c_api_object.html#unqlite_vm"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">virtual
machine</span></span></font></font></a><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">.</span></span></font></font></p><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;"><br>
The
application-defined foreign function implementation will pass this
pointer through into calls to dozens of interfaces, these includes:</span></span></font></font><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;"></span></span></font></font><br>
<a style="font-family: Courier New;" href="c_api/unqlite_context_output.html"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">unqlite_context_output()</span></span></font></a><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">, </span></span></font></font><a style="font-family: Courier New;" href="c_api/unqlite_context_throw_error.html"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">unqlite_context_throw_error()</span></span></font></a><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">, </span></span></font></font><a style="font-family: Courier New;" href="c_api/unqlite_value_alloc.html"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">unqlite_context_new_scalar()</span></span></font></a><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">, </span></span></font></font><a style="font-family: Courier New;" href="c_api/unqlite_context_user_data.html"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">unqlite_context_user_data()</span></span></font></a><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">, </span></span></font></font><a style="font-family: Courier New;" href="c_api/unqlite_context_alloc.html"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">unqlite_context_alloc_chunk()</span></span></font></a><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">
and many more.</span></span></font></font><br>
<p style="margin-bottom: 0cm;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;"><br>
</span></span></font></font></p>

<p style="margin-bottom: 0cm;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">The
second parameter is the total number of arguments passed to the
foreign function.</span></span></font></font><br>
</p>

<p style="margin-bottom: 0cm;"><br>
</p>

<p style="margin-bottom: 0cm;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">The
last parameter is an array of pointers to </span></span></font></font><a style="font-family: Courier New;" href="c_api_object.html#unqlite_value"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">unqlite_value</span></span></font></a><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">
which represents function arguments. The implementation of the
foreign functions can extract their contents via one of these
interfaces:</span></span></font></font></p>
<p style="margin-bottom: 0cm;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;"><br>
</span></span></font></font></p>


<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_value_cast.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_value_to_int()</span></font></a><font color="#000000"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">
</span></font></font></p>

<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_value_cast.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_value_to_bool()</span></font></a><font color="#000000"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">
</span></font></font></p>

<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_value_cast.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_value_to_int64()</span></font></a><font color="#000000"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">
</span></font></font></p>

<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_value_cast.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_value_to_double()</span></font></a><font color="#000000"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">
</span></font></font></p>

<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_value_cast.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_value_to_string()</span></font></a><font color="#000000"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">
</span></font></font></p>

<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_value_cast.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_value_to_resource()</span></font></a><font color="#000000"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">
</span></font></font></p>

<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_value_cast.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_value_compare()</span></font></a></p>
<p style="margin-left: 1.25cm; margin-bottom: 0cm;"><a href="../../jx9/website/c_api_func.html#Foreign_Function_Parameter_Values"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"><br>
</span></font></font></a></p>


<p style="font-style: normal; font-weight: normal;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">The
computation result (i.e. the return value) of the foreign function
can be set via one of these interfaces:</font></font></p>
<p style="font-style: normal; font-weight: normal;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></p>


<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_int()</font></a><font color="#000000"><font style="font-size: 10pt;" size="2">
</font></font></p>

<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_int64()</font></a><font color="#000000"><font style="font-size: 10pt;" size="2">
</font></font></p>

<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_bool()</font></a><font color="#000000"><font style="font-size: 10pt;" size="2">
</font></font></p>

<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_double()</font></a><font color="#000000"><font style="font-size: 10pt;" size="2">
</font></font></p>

<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_null()</font></a><font color="#000000"><font style="font-size: 10pt;" size="2">
</font></font></p>

<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_string()</font></a><font style="font-size: 10pt;" size="2">
</font></p>

<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_value()</font></a><font color="#000000"><font style="font-size: 10pt;" size="2">
</font></font></p>

<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_resource()</font></a><font color="#000000"><font style="font-size: 10pt;" size="2">
</font></font></p>

<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_string_format()</font></a></p>
<p style="margin-left: 1.25cm; margin-bottom: 0cm;"><a href="../../jx9/website/c_api_func.html#Setting_The_Result_Of_A_Foreign_Function"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></a><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">
</font></font></font></p>


<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;">
<font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">If
no call is made to one of these interfaces, then a NULL return value
is assumed.</font></font></p>

<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;">
<br>
</p>

<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;">
<font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font face="Verdana, sans-serif">The
implementation of the foreign function must return </font><a style="font-family: Courier New;" href="c_api_const.html">UNQLITE_OK</a><font face="Verdana, sans-serif">
on success, but if the callbacks wishes to abort processing (to stop
program execution) and thus to emulate the Jx9 <span style="font-weight: bold;"></span> <span style="font-weight: bold;">die</span> <a href="jx9_lang.html">construct</a>, it must return </font><a style="font-family: Courier New;" href="c_api_const.html">UNQLITE_ABORT</a><font face="Verdana, sans-serif">
instead.</font></font></font></p>

<h1 class="western" style="font-style: normal;"><font><font><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Typical
Implementation Of A Foreign Function<br>
</font></font></font></font></h1>

<p style="font-style: normal;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">A
typical implementation of a foreign function would perform the
following operations in order:</font></font></p>

<ol>

  <li>
    
    <p style="font-style: normal;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Check if the given arguments are of
the expected numbers and expected types. If the function accepts
arguments, this is the first operation it must perform before doing any
serious work. For that, a set of interfaces are available:</font></font><br>
    </p>
    <a href="../../jx9/website/c_api_func.html#Setting_The_Result_Of_A_Foreign_Function"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></a>
    
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_type.html"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;">unqlite_value_is_int</span></font></a></p>

    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_type.html"><font style="font-size: 10pt;" size="2">unqlite_value_is_float</font></a></p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_type.html"><font style="font-size: 10pt;" size="2">unqlite_value_is_bool</font></a></p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_type.html"><font style="font-size: 10pt;" size="2">unqlite_value_is_string</font></a></p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_type.html"><font style="font-size: 10pt;" size="2">unqlite_value_is_null</font></a></p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_type.html"><font style="font-size: 10pt;" size="2">unqlite_value_is_numeric</font></a></p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_type.html"><font style="font-size: 10pt;" size="2">unqlite_value_is_callable</font></a></p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_type.html"><font style="font-size: 10pt;" size="2">unqlite_value_is_json_array</font></a></p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_type.html"><font style="font-size: 10pt;" size="2">unqlite_value_is_scalar</font></a></p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_type.html"><font style="font-size: 10pt;" size="2">unqlite_value_is_json_object</font></a></p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_type.html"><font style="font-size: 10pt;" size="2">unqlite_value_is_resource</font></a></p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_type.html"><font style="font-size: 10pt;" size="2">unqlite_value_is_empty</font></a></p><a href="../../jx9/website/c_api_func.html#Setting_The_Result_Of_A_Foreign_Function"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></a>
    <p style="margin-bottom: 0cm;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">To check if the given arguments are
of the expected number, simply compare the expected number with the <b>argc</b>
parameter (Second parameter the foreign function takes).</font></font></p><a href="../../jx9/website/c_api_func.html#Setting_The_Result_Of_A_Foreign_Function"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></a>
  </li>
  <li>
    
    <p style="margin-bottom: 0cm;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">If the foreign function accepts
arguments, it may need to extract their contents via the following set of
interfaces:</font></font></p>
    <a href="../../jx9/website/c_api_func.html#Setting_The_Result_Of_A_Foreign_Function"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></a>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_cast.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_value_to_int()</span></font></a><font color="#000000"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"> </span></font></font>
    </p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_cast.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_value_to_bool()</span></font></a><font color="#000000"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"> </span></font></font>
    </p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_cast.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_value_to_int64()</span></font></a><font color="#000000"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"> </span></font></font>
    </p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_cast.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_value_to_double()</span></font></a><font color="#000000"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"> </span></font></font>
    </p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_cast.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_value_to_string()</span></font></a><font color="#000000"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"> </span></font></font>
    </p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_cast.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_value_to_resource()</span></font></a><font color="#000000"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"> </span></font></font>
    </p>
    <p style="margin-bottom: 0cm; margin-left: 40px; font-family: Courier New;"><a href="c_api/unqlite_value_cast.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_value_compare()</span></font></a></p><a href="../../jx9/website/c_api_func.html#Setting_The_Result_Of_A_Foreign_Function"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></a>
  </li>
<li>
    <p style="margin-bottom: 0cm; font-weight: normal;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Perform
the desired computation.</font></font></p><a href="../../jx9/website/c_api_func.html#Setting_The_Result_Of_A_Foreign_Function"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></a>
  </li><li>
    <p style="margin-bottom: 0cm;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">Allocate
additional </span></font></font><a style="font-family: Courier New;" href="c_api_object.html#unqlite_value"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_value</span></font></a><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"> via </span></font></font><a style="font-family: Courier New;" href="c_api/unqlite_value_alloc.html"><font style="font-size: 10pt;" size="2">unqlite_context_new_scalar()</font></a><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">
and/or </span></font></font></font><a style="font-family: Courier New;" href="c_api/unqlite_value_alloc.html"><font style="font-size: 10pt;" size="2">unqlite_context_new_array()</font></a><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"> </span></font></font></font><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">especially if the foreign
function works with JSON arrays or JSON objects (see below for a working example).</span></font></font></p><a href="../../jx9/website/c_api_func.html#Setting_The_Result_Of_A_Foreign_Function"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></a>
  </li><li>
    <p style="margin-bottom: 0cm;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">If
something goes wrong while processing the input, the foreign function can throw an error via the </span></font></font><a style="font-family: Courier New;" href="c_api/unqlite_context_throw_error.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_context_throw_error()</span></font></a><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"> or </span></font></font><a style="font-family: Courier New;" href="c_api/unqlite_context_throw_error.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_context_throw_error_format()</span></font></a><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"> interfaces.</span></font></font></p><a href="../../jx9/website/c_api_func.html#Setting_The_Result_Of_A_Foreign_Function"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></a>
  </li><li>
    <p style="margin-bottom: 0cm;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">If
the foreign function wishes to output a message and thus to emulate the Jx9 </span></font></font><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"><span style="font-weight: bold;">print</span> <a href="jx9_lang.html">construct</a>, it may call </span></font></font><a style="font-family: Courier New;" href="c_api/unqlite_context_output.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_context_output()</span></font></a><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"> or </span></font></font><a style="font-family: Courier New;" href="c_api/unqlite_context_output.html"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">unqlite_context_output_format()</span></font></a><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">.</span></font></font></p><a href="../../jx9/website/c_api_func.html#Setting_The_Result_Of_A_Foreign_Function"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></a>
  </li>
  <li>
    <p style="margin-bottom: 0cm; font-weight: normal;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">When
done, the computation result (i.e. return value) of the foreign function can
be set via one of the these interfaces:</font></font></p><a href="../../jx9/website/c_api_func.html#Setting_The_Result_Of_A_Foreign_Function"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></a>
    <p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_int()</font></a><font color="#000000"><font style="font-size: 10pt;" size="2">
</font></font></p>


    <p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_int64()</font></a><font color="#000000"><font style="font-size: 10pt;" size="2">
</font></font></p>


    <p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_bool()</font></a><font color="#000000"><font style="font-size: 10pt;" size="2">
</font></font></p>


    <p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_double()</font></a><font color="#000000"><font style="font-size: 10pt;" size="2">
</font></font></p>


    <p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_null()</font></a><font color="#000000"><font style="font-size: 10pt;" size="2">
</font></font></p>


    <p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_string()</font></a><font style="font-size: 10pt;" size="2">
</font></p>


    <p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_value()</font></a><font color="#000000"><font style="font-size: 10pt;" size="2">
</font></font></p>


    <p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_resource()</font></a><font color="#000000"><font style="font-size: 10pt;" size="2">
</font></font></p>


    <p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;"><a href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_string_format()</font></a></p>

    <a href="../../jx9/website/c_api_func.html#Setting_The_Result_Of_A_Foreign_Function"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></a></li>
<li>
    <p style="margin-bottom: 0cm;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">And finally, return </span></font></font></font><a style="font-family: Courier New;" href="c_api_const.html"><font style="font-size: 10pt;" size="2">UNQLITE_OK</font></a><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"> when done. Note that you do </span></font></font></font><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b>not need </b></font></font></font><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;">to
release any allocated resource manually via&nbsp; <a style="font-family: Courier New;" href="c_api/unqlite_value_alloc.html">unqlite_context_release_value()</a>, &nbsp;</span></font></font></font><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"> the virtual machine will
release any allocated resources for you automatically.</font></font></p>
    <p style="margin-bottom: 0cm; font-weight: normal;"><font color="#000000"> </font> </p>
  </li>
</ol>


<h1 class="western" style="font-style: normal;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Foreign
Function Examples</font></font></h1>

<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" align="left">
<font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">We
will start our examples with the simplest foreign function implemented
in C which perform a simple right shift operation on a given number
and return the new shifted </font></font></font><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">value as it's computation result (i.e.
return value), here is the C code:</font></font></font>
</p>
<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" align="left"><br>
</p>


<div style="text-align: left; margin-left: 158px; width: 732px;" id="code">

<ol>
<li><p style="font-weight: normal;"><font face="Courier New, monospace"><font size="2"><font color="#0000ff">int</font><font color="#000000">
	shift_func(</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp; </font><a href="c_api_object.html#unqlite_context"><font face="Courier New, monospace"><font size="2">unqlite_context</font></font></a><font color="#000000"><font face="Courier New, monospace"><font size="2">
	*pCtx, </font></font></font><font color="#008000"><font face="Courier New, monospace"><font size="2">/*
	Call Context */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#0000ff">int</font><font color="#000000">
	argc, </font><font color="#008000">/* Total number of arguments
	passed to the function */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp; </font><a href="c_api_object.html#unqlite_value"><font face="Courier New, monospace"><font size="2">unqlite_value</font></font></a><font color="#000000"><font face="Courier New, monospace"><font size="2">
	**argv </font></font></font><font color="#008000"><font face="Courier New, monospace"><font size="2">/*
	Array of function arguments */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000"><font face="Courier New, monospace"><font size="2">)</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000"><font face="Courier New, monospace"><font size="2">{</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#0000ff">int</font><font color="#000000">
	num;</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Make sure there is at least one argument and is of the</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#008000">&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">* expected type
	[i.e: numeric].</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#008000">&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">*/</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;
	</font><font color="#0000ff"><font face="Courier New, monospace"><font size="2">if</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">(
	argc &lt; 1 || !</font></font></font><a href="c_api/unqlite_value_type.html"><font face="Courier New, monospace"><font size="2">unqlite_value_is_numeric</font></font></a><font color="#000000"><font face="Courier New, monospace"><font size="2">(argv[0])
	){</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#008000">&nbsp;&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">* Missing/Invalid
	argument,throw a warning and return FALSE.</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#008000">&nbsp;&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">* Note that you do
	not need to log the function name,JX9 will</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#008000">&nbsp;&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">* automatically
	append the function name for you.</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#008000">&nbsp;&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">*/</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;&nbsp; </font><a href="c_api/unqlite_context_throw_error.html"><font face="Courier New, monospace"><font size="2">unqlite_context_throw_error</font></font></a><font color="#000000"><font face="Courier New, monospace"><font size="2">(pCtx,UNQLITE_CTX_WARNING,</font></font></font><font color="#a31515"><font face="Courier New, monospace"><font size="2">"Missing
	numeric argument"</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">);</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Return false */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;&nbsp; <font face="Courier New, monospace"><font size="2"><a href="c_api/unqlite_result_fill.html">unqlite_result_bool</a>(pCtx,0);</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#0000ff">return</font><font color="#000000"> UNQLITE_OK;</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;
	<font face="Courier New, monospace"><font size="2">}</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Extract the number */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;
	<font face="Courier New, monospace"><font size="2">num = <a href="c_api/unqlite_value_cast.html">unqlite_value_to_int</a>(argv[0]);</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Shift by 1 */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;
	<font face="Courier New, monospace"><font size="2">num &lt;&lt;= 1;</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Return the new value */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp; <font face="Courier New, monospace"><font size="2"><a href="c_api/unqlite_result_fill.html">unqlite_result_int</a>(pCtx,num);</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	All done */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000">&nbsp;
	</font><font color="#0000ff"><font face="Courier New, monospace"><font size="2">return</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2"> </font></font></font><font face="Courier New, monospace"><font size="2">UNQLITE_OK</font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">;</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;" align="left"><font color="#000000"><font face="Courier New, monospace"><font size="2">}</font></font></font></p>
</li>
</ol>


</div>

<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" align="left">
<font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font face="Verdana, sans-serif"><br>
</font></font></font></font></p>






<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" align="left"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font face="Verdana, sans-serif">On
line 11, we check if there is at least one argument and is </font><font face="Verdana, sans-serif">numeric</font><font face="Verdana, sans-serif">
(integer or float or a string that looks like a number). If not, we
</font><font face="Verdana, sans-serif">throw
an error</font><font face="Verdana, sans-serif"> on line 17 and
we return a Boolean false (zero) on line 19 using </font><a style="font-family: Courier New;" href="c_api/unqlite_result_fill.html">unqlite_result_bool()</a><font color="#000000"><font face="Verdana, sans-serif">.</font></font></font></font></font></p>
<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" align="left"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font color="#000000"><font face="Verdana, sans-serif"><br>
</font></font></font></font></font></p>
<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" align="left"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font color="#000000"><font face="Verdana, sans-serif">We
extract the function argument which is the number to shift on line 23
using </font></font><a style="font-family: Courier New;" href="c_api/unqlite_value_cast.html">unqlite_value_to_int()</a><font color="#000000"><font face="Verdana, sans-serif">.</font></font></font></font></font></p>






<p style="margin-bottom: 0cm;" align="left"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></font></p>

<p style="margin-bottom: 0cm;" align="left"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">We
perform the desired computation (right shift the given number by one)
on line 25.<span style="font-style: normal;"><span style="font-weight: normal;"><br></span></span></font></font></font></p>

<p style="margin-bottom: 0cm;" align="left"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;"><br>
</span></span></font></font></font></p>

<p style="margin-bottom: 0cm;" align="left"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">
And
finally, we return the new value as our computation result one line 27
using a call to </span></span></font></font></font><a style="font-family: Courier New;" href="c_api/unqlite_result_fill.html"><font style="font-size: 10pt;" size="2">unqlite_result_int()</font></a><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">.</span></span></font></font></font></p>




<p style="margin-bottom: 0cm;" align="left"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;"><br>
</span></span></font></font></font></p>

<p style="margin-bottom: 0cm;" align="left"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">Now
after </span></span></font></font></font><a href="c_api/unqlite_create_function.html"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">installing</font></font></a><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">
this function (<a href="http://unqlite.org/db/unqlite_func_intro.c">Compile this C file</a> for a working example), it can be called from your <a href="jx9.html">Jx9</a> script as follows:</span></span></font></font></font></p>


<p style="margin-bottom: 0cm;" align="left"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;"><br>
</span></span></font></font></font></p>


<div style="margin-left: 159px; width: 453px; font-family: Courier New;" id="code">
<p style="margin-bottom: 0cm; font-weight: normal;" align="left"><font color="#000000"><font style="font-size: 10pt;" size="2">&nbsp;&nbsp; <span style="color: blue;"><span style="font-family: Courier New;">print</span></span><span style="font-family: Courier New;">
shift_func(150); </span></font></font>
<font style="color: green; font-family: Courier New;" color="#000000"><font style="font-size: 10pt;" size="2">//you
should see 300.</font></font></p>




</div>


<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" align="left">
<font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></font></p>

<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" align="left"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Another
simple foreign function named date_func(). This function does not
expect arguments and return the current system date in a string. A
typical call to this function would return something like: <span style="font-style: italic;">2012-23-09 13:53:30</span>. Here is the implementation</font></font></font></p>

<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" align="left"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></font></p>


<div style="margin-left: 159px; width: 651px; font-family: Courier New;" id="code">

<ol>
<li><p style="font-weight: normal;"><font face="Courier New, monospace"><font size="2"><font color="#0000ff"><span style="font-style: normal;">int</span></font><font color="#000000">
	</font><font color="#000000"><span style="font-style: normal;">date_func(</span></font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><a href="c_api_object.html#unqlite_context"><font face="Courier New, monospace"><font size="2">unqlite_context</font></font></a><font color="#000000"><font face="Courier New, monospace"><font size="2">
	*pCtx, </font></font></font><font color="#008000"><font face="Courier New, monospace"><font size="2">/*
	Call Context */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><font face="Courier New, monospace"><font size="2"><font color="#0000ff">int</font><font color="#000000">
	argc, </font><font color="#008000">/* Total number of arguments
	passed to the function */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><a href="c_api_object.html#unqlite_value"><font face="Courier New, monospace"><font size="2">unqlite_value</font></font></a><font color="#000000"><font face="Courier New, monospace"><font size="2">
	**argv </font></font></font><font color="#008000"><font face="Courier New, monospace"><font size="2">/*
	Array of function arguments*/</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000"><font face="Courier New, monospace"><font size="2">){</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;
	<font face="Courier New, monospace"><font size="2">time_t tt;</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#0000ff">struct</font><font color="#000000">
	tm *pNow;</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Get the current time */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;
	<font face="Courier New, monospace"><font size="2">time(&amp;tt);</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; <font face="Courier New, monospace"><font size="2">pNow
	= localtime(&amp;tt);</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	</font></font></font>
	</p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#008000">&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">* Return the
	current date.</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#008000">&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">*/</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; <font face="Courier New, monospace"><font size="2"><a href="c_api/unqlite_result_fill.html">unqlite_result_string_format</a>(pCtx,</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#a31515">"%04d-%02d-%02d
	%02d:%02d:%02d"</font><font color="#000000">, </font><font color="#008000">/*
	printf() style format */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">pNow-&gt;tm_year +
	1900, </font><small><font color="#008000">/* Year */</font></small></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">pNow-&gt;tm_mday,
	</font><small><font color="#008000">/* Day of the month */</font></small></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">pNow-&gt;tm_mon +
	1, </font><small><font color="#008000">/* Month number */</font></small></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">pNow-&gt;tm_hour,
	</font><small><font color="#008000">/* Hour */</font></small></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">pNow-&gt;tm_min, </font><small><font color="#008000">/*
	Minutes */</font></small></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">pNow-&gt;tm_sec </font><small><font color="#008000">/*
	Seconds */</font></small></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; <font face="Courier New, monospace"><font size="2">);</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	All done */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#0000ff">return</font><font color="#000000"> UNQLITE_OK;</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000"><font face="Courier New, monospace"><font size="2">}</font></font></font></p>
</li>
</ol>


</div>

<p style="margin-bottom: 0cm;" align="left">
</p>

<p style="margin-bottom: 0cm;" align="left"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;"><br>
</span></span></font></font></font></p>

<p style="margin-bottom: 0cm;" align="left"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">We
get the current date on line 10 using the libc <span style="font-family: Courier New;">localtime()</span> routine and we
return it using&nbsp; </span></span></font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2"><a href="c_api/unqlite_result_fill.html">unqlite_result_string_format</a></font></font></font><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">&nbsp; on line 14. This function is a work-alike of the </span></span></font></font></font><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">"printf()"
family of functions from the standard C library which is used to
append a formatted string</span></span></font></font></font><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">.</span></span></font></font></font></p>


<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" align="left">
<br>
</p>

<p style="margin-bottom: 0cm;" align="left"><a style="font-family: Courier New; font-weight: bold;" href="http://unqlite.org/db/unqlite_func_intro.c"><font style="font-size: 10pt;" size="2">Compile this C file</font></a><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;"><span style="font-weight: normal;">
for a working version of the function defined above plus others
foreign functions. </span></span></font></font></font>
</p>

<h1 class="western" style="font-style: normal;"><font><font><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Working
With JSON Arrays/Objects<br>
</font></font></font></font></h1>

<p style="font-style: normal; font-weight: normal;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Working
with JSON arrays or objects is relatively easy and involves two or three additional
call to Jx9 (Via UnQLite) interfaces. A typical implementation of a foreign
function that works with arrays and/or objects would perform the following
operations:</font></font></font></p>

<ol>
<li>
    <p style="font-style: normal; font-weight: normal;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Call <a style="font-family: Courier New;" href="c_api/unqlite_value_alloc.html">unqlite_context_new_array()</a>
to allocate a fresh <a style="font-family: Courier New;" href="c_api_object.html#unqlite_value">unqlite_value</a>
of
type array or object. The new array/object is empty and need to be
populated. This interface is unified for JSON arrays as well JSON objects.<br>
</font></font></font></p>
  </li><li>
    <p style="font-style: normal; font-weight: normal;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Call <a style="font-family: Courier New;" href="c_api/unqlite_value_alloc.html">unqlite_context_new_scalar()</a>
to allocate a new scalar <a style="font-family: Courier New;" href="c_api_object.html#unqlite_value">unqlite_value</a>. This
value is used to populate array/object entries with the desired value. </font></font></font>
    </p>
  </li><li>
    <p style="font-style: normal; font-weight: normal;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Populate the array/object using one or more
calls to <a style="font-family: Courier New;" href="c_api/unqlite_array_add_elem.html">unqlite_array_add_elem()</a>
and its wrappers. Again, these interfaces are unified for JSON arrays and objects.<br>
</font></font></font></p>
  </li><li>
    <p style="font-style: normal; font-weight: normal;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Finally, return the fresh
array/object using the <a style="font-family: Courier New;" href="c_api/unqlite_result_fill.html">unqlite_result_value()</a>
interface.</font></font></font></p>
  </li>
</ol>

<p style="font-style: normal; font-weight: normal;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">We'll start our examples by a simple foreign function named
<span style="font-family: Courier New;">array_time_func()</span>. This function does not expects arguments and
return the current time in a JSON array. A typical output of this function
would look like this:</font></font></font></p>
<p style="font-style: normal; font-weight: normal;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></font></p>

<div style="margin-left: 130px; width: 473px; text-align: left;" id="code"><font style="font-size: 10pt; font-family: Courier New;" size="2"><span style="color: blue;">print</span>(array_time_func());<br>
</font><font style="font-family: Courier New;" face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font color="#008000">/* JSON Array */</font></font></font><br style="font-family: Courier New;"><span style="font-family: Courier New;">

[14,53,30]</span>

</div>

<p style="margin-bottom: 0cm;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Here
is the C code.</font></font></p>

<div style="margin-left: 127px; font-family: Courier New; width: 807px;" id="code">

<ol>
<li><p><font color="#000000"><font face="Courier New, monospace"><font size="2"><font color="#0000ff">int</font>
	array_time_func(<span style="color: blue;">unqlite_context</span> *pCtx,<font color="#0000ff">int</font>
	argc,<span style="color: blue;">unqlite_value</span> **argv)</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000"><font face="Courier New, monospace"><font size="2">{</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; <font face="Courier New, monospace"><font size="2"><span style="color: blue;">unqlite_value</span> *pArray;
	</font><font color="#008000">/* Our JSON Array */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; <font face="Courier New, monospace"><font size="2"><span style="color: blue;">unqlite_value</span> *pValue;
	</font><font color="#008000">/* Array entries value */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;
	<font face="Courier New, monospace"><font size="2">time_t tt;</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#0000ff">struct</font><font color="#000000">
	tm *pNow;</font></font></font></p>
	</li><li>
	<br>
</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Get the current time first */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;
	<font face="Courier New, monospace"><font size="2">time(&amp;tt);</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; <font face="Courier New, monospace"><font size="2">pNow
	= localtime(&amp;tt);</font></font></font></p>
	</li><li>
	<br>
</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Create a new json array */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;
	<font face="Courier New, monospace"><font size="2">pArray = unqlite_context_new_array(pCtx);</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Create a worker scalar value */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;
	<font face="Courier New, monospace"><font size="2">pValue = </font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">unqlite</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">_context_new_scalar(pCtx);</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><font face="Courier New, monospace"><font size="2"><font color="#0000ff">if</font><font color="#000000">(
	pArray == 0 || pValue == 0 ){</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000"><font face="Courier New, monospace"><font size="2">unqlite</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">_context_throw_error(pCtx,JX9_CTX_ERR,</font><small><font color="#a31515">"Fatal,
	JX9 is running out of memory"</font></small><font color="#000000">);</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	emulate the die() construct */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#0000ff">return</font><font color="#000000"> UNQLITE_ABORT;</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; <font face="Courier New, monospace"><font size="2">}</font></font></font></p>
	</li><li>
	<br>
</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Populate the JSON array.</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#008000">&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">* Note that we will
	use the same worker scalar value (pValue) here rather than</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#008000">&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">* allocating a new
	value for each array entry. This is due to the fact</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#008000">&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">* that the
	populated array will make it's own private copy of the inserted</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#008000">&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">* key(if available)
	and it's associated value.</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#008000">&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">*/</font></font></font></p>
	</li><li>
	<br>
</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;</font><font color="#000000"><font face="Courier New, monospace"><font size="2">unqlite</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">_value_int(pValue,pNow-&gt;tm_hour);
	</font><small><font color="#008000">/* Hour */</font></small></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Insert the hour at the first available index */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;</font><font color="#000000"><font face="Courier New, monospace"><font size="2">unqlite</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">_array_add_elem(pArray,0</font><font color="#000000">,<small>pValue</small>
	</font><small><font color="#008000">/* Will make it's own copy */</font></small><font color="#000000">);</font></font></font></p>
	</li><li>
	<br>
</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Overwrite the previous value */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;</font><font color="#000000"><font face="Courier New, monospace"><font size="2">unqlite</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">_value_int(pValue,pNow-&gt;tm_min);
	</font><small><font color="#008000">/* Minutes */</font></small></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Insert minutes */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;</font><font color="#000000"><font face="Courier New, monospace"><font size="2">unqlite</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">_array_add_elem(pArray,0</font><font color="#000000">,<small>pValue</small>
	</font><small><font color="#008000">/* Will make it's own copy */</font></small><font color="#000000">);</font></font></font></p>
	</li><li>
	<br>
</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Overwrite the previous value */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;</font><font color="#000000"><font face="Courier New, monospace"><font size="2">unqlite</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">_value_int(pValue,pNow-&gt;tm_sec);
	</font><small><font color="#008000">/* Seconds */</font></small></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Insert seconds */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;</font><font color="#000000"><font face="Courier New, monospace"><font size="2">unqlite</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">_array_add_elem(pArray,0</font><font color="#000000">,<small>pValue</small>
	</font><small><font color="#008000">/* Will make it's own copy */</font></small><font color="#000000">);</font></font></font></p>
	</li><li>
	<br>
</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	Return the array as the function return value */</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;</font><font color="#000000"><font face="Courier New, monospace"><font size="2">unqlite</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">_result_value(pCtx,pArray);</font></font></font></p>
	</li><li>
	<br>
</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp; </font><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
	All done. Don't worry about freeing memory here, every</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#008000">&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">* allocated
	resource will be released automatically by the engine</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#008000">&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">* as soon we return
	from this foreign function.</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#008000">&nbsp;&nbsp;
	<font face="Courier New, monospace"><font size="2">*/</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;
	</font><font face="Courier New, monospace"><font size="2"><font color="#0000ff">return</font><font color="#000000"> UNQLITE_OK;</font></font></font></p>
	</li><li><p style="margin-bottom: 0cm;"><font color="#000000"><font face="Courier New, monospace"><font size="2">}</font></font></font></p>
</li>
</ol>


</div>

<div style="text-align: left; margin-left: 40px;"><font style="font-weight: bold; font-family: Courier New;" color="#000000"><font style="font-size: 10pt;" size="2"><a href="http://unqlite.org/db/unqlite_func_intro.c">Get a Copy of The C File</a></font></font><br>
</div>


<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Verdana, sans-serif"><small><span style="font-family: Verdana;"><br>
</span></small></font></font></p>
<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Verdana, sans-serif"><small><span style="font-family: Verdana;">We
allocate a fresh empty JSON array on line 13 using a call to </span></small><font style="font-size: 10pt;" size="2"><a style="font-family: Courier New;" href="c_api/unqlite_value_alloc.html">unqlite_context_new_array()</a>.
Also, we
allocate a fresh scalar value one line 15 using a call to <a style="font-family: Courier New;" href="c_api/unqlite_value_alloc.html">unqlite_context_new_scalar()</a>.</font></font></font></p>




<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">We
populate the scalar <a style="font-family: Courier New;" href="c_api_object.html#unqlite_value">unqlite_value</a>
with the desired value, here the current hour on line 29 using a call
to <a style="font-family: Courier New;" href="c_api/unqlite_value_fill.html">unqlite_value_int()</a>
and we insert it in the new array using <a style="font-family: Courier New;" href="c_api/unqlite_array_add_elem.html">unqlite_array_add_elem()</a> on line 31.</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></font></p>




<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">This
process is repeated again on line 34, 36, 39 and 41. Note that we use
the same scalar value to populate the array with the three entries.
This is due to the fact that a call to <a style="font-family: Courier New;" href="c_api/unqlite_array_add_elem.html">unqlite_array_add_elem()</a>
and its wrappers
will make a private copy of the inserted value and so it is safe to
use the same scalar value for other insertions. </font></font></font>
</p>


<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Finally,
we return our array as our computation result one line 44 using <a style="font-family: Courier New;" href="c_api/unqlite_result_fill.html">unqlite_result_value()</a>.</font></font></font></p>

<h1 class="western"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Other
useful links</font></font></h1>


<p style="font-weight: normal;" align="left"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Check
out the <a href="api_intro.html">Introduction
To The UnQLite C/C++ Interface</a> for an introductory overview and
roadmap to the dozens of UnQLite interface functions.</font></font></p>





<p style="font-weight: normal;" align="left"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">A
separate document, <a href="c_api.html">The UnQLite C/C++ Interface</a>, provides detailed specifications for all of
the various C/C++ APIs for UnQLite. Once the reader understands the basic
principles of operation for UnQLite, that
<a href="c_api.html">document</a> should be used as a reference guide.</font></font></p>






<p style="font-weight: normal;" align="left"><font face="Verdana, sans-serif"><font color="#000000"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;">Any
questions, </span></font></font><font color="#000000"><font style="font-size: 10pt;" size="2"><span style="font-style: normal;">visit the <a href="support.html">Support Page</a> for additional
information.</span></font></font></font></p>

<br>
</div>
<hr style="width: 100%; height: 2px;">
<div style="text-align: right; margin-top: 0px; height: 91px;"><small><small><a href="http://www.symisc.net/"><img style="border: 0px solid ; width: 170px; height: 70px;" alt="Symisc Systems" src="images/symisc.png"></a></small></small>
<div style="text-align: left; margin-top: 0px; height: 14px;"><small><small style="font-family: Verdana;">Copyright © <a href="http://www.symisc.net/">Symisc Systems</a></small></small><br>
</div>
</div>
</div>

</body></html>